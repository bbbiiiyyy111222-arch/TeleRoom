<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>TeleRoom ‚Äî —Ç–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</title>
    <style>
        /* ========== –°–ë–†–û–° –ò –®–†–ò–§–¢–´ ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: radial-gradient(circle at 20% 30%, #1a1b2f, #0c0d1a);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 12px;
        }

        #app {
            width: 100%;
            max-width: 480px;
            height: 90vh;
            background: rgba(20, 22, 36, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 36px;
            box-shadow: 0 25px 50px -8px rgba(0,0,0,0.6), inset 0 0 0 1px rgba(255,255,255,0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            color: #fff;
        }

        /* ========== –°–¢–ï–ö–õ–Ø–ù–ù–´–ï –≠–§–§–ï–ö–¢–´ ========== */
        .glass {
            background: rgba(30, 32, 48, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 24px;
        }

        /* ========== –õ–û–ì–ò–ù ========== */
        #login-screen {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 28px;
            background: radial-gradient(circle at 30% 40%, #2c2e4a, #1a1c2c);
            color: white;
        }

        .logo {
            font-size: 96px;
            margin-bottom: 8px;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.4));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
            100% { transform: translateY(0px); }
        }

        .app-title {
            font-size: 44px;
            font-weight: 800;
            margin-bottom: 6px;
            background: linear-gradient(135deg, #b794f4, #a0a8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .app-subtitle {
            font-size: 15px;
            margin-bottom: 48px;
            opacity: 0.7;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .login-input {
            width: 100%;
            padding: 18px 24px;
            margin-bottom: 16px;
            border: none;
            border-radius: 40px;
            font-size: 16px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            transition: 0.25s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: #a0a8ff;
            background: rgba(0,0,0,0.5);
            transform: scale(1.02);
        }

        .login-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 40px;
            background: linear-gradient(145deg, #5f6cff, #3f4ad0);
            color: white;
            font-size: 18px;
            font-weight: 700;
            margin-top: 20px;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 12px 30px -8px #3f4ad080;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 35px -6px #3f4ad0c0;
        }

        #username-error {
            color: #ff8a8a;
            margin-top: 8px;
            font-size: 14px;
            display: none;
            background: rgba(255,80,80,0.15);
            padding: 10px 18px;
            border-radius: 60px;
            backdrop-filter: blur(4px);
        }

        /* ========== –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° ========== */
        #main-screen {
            height: 100%;
            display: none;
            flex-direction: column;
            background: #0f1016;
        }

        .header {
            background: rgba(18, 20, 28, 0.9);
            backdrop-filter: blur(16px);
            padding: 14px 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: 0.2s;
            padding: 6px 12px 6px 6px;
            border-radius: 40px;
            background: rgba(255,255,255,0.03);
        }

        .user-info:active {
            background: rgba(255,255,255,0.08);
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            background: linear-gradient(145deg, #5f6cff, #3b45b0);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 600;
            border: 2px solid rgba(255,255,255,0.25);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            color: white;
        }

        .user-name {
            font-weight: 600;
            font-size: 16px;
            color: white;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.05);
            color: white;
            font-size: 22px;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.12);
            transform: scale(1.05);
        }

        /* ========== –¢–ê–ë–´ ========== */
        .tabs {
            display: flex;
            background: #0c0d12;
            padding: 10px 12px;
            gap: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }

        .tab {
            flex: 1;
            padding: 12px 6px;
            border: none;
            background: transparent;
            font-size: 15px;
            font-weight: 600;
            color: #9498a5;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: 0.2s;
        }

        .tab.active {
            background: linear-gradient(145deg, #2c2f42, #1f212f);
            color: white;
            box-shadow: inset 0 1px 1px rgba(255,255,255,0.05);
        }

        /* ========== –ö–û–ù–¢–ï–ô–ù–ï–†–´ –°–ü–ò–°–ö–û–í ========== */
        #chats-list, #groups-list, #contacts-list, #profile-screen {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
            display: none;
            background: #0f1016;
        }

        .active-list {
            display: block !important;
        }

        /* ========== –ü–û–ò–°–ö ========== */
        .search-container {
            padding: 8px 4px 16px 4px;
            background: transparent;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .search-input {
            width: 100%;
            padding: 14px 20px;
            border: none;
            border-radius: 40px;
            font-size: 15px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.06);
            color: white;
            transition: 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #6f7cff;
            background: rgba(20,20,40,0.6);
        }

        .search-input::placeholder {
            color: rgba(255,255,255,0.4);
        }

        /* ========== –ö–ê–†–¢–û–ß–ö–ò –ß–ê–¢–û–í ========== */
        .chat-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px;
            background: rgba(20, 22, 32, 0.7);
            backdrop-filter: blur(6px);
            border-radius: 24px;
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.03);
            cursor: pointer;
            transition: 0.2s ease;
        }

        .chat-item:hover {
            background: rgba(35, 38, 52, 0.9);
            transform: translateX(6px);
            border-color: rgba(160, 168, 255, 0.3);
        }

        .chat-avatar {
            width: 56px;
            height: 56px;
            background: linear-gradient(145deg, #4f5bdb, #323ca0);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 26px;
            font-weight: 600;
            box-shadow: 0 8px 18px rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.15);
        }

        .chat-info {
            flex: 1;
        }

        .chat-name {
            font-weight: 700;
            font-size: 17px;
            margin-bottom: 5px;
            color: white;
        }

        .chat-last-message {
            font-size: 14px;
            color: #a6a9b6;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .chat-badge {
            background: #5f6cff;
            color: white;
            border-radius: 40px;
            padding: 4px 10px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 4px 10px #3f4ad080;
        }

        .online-status { color: #64e6b0; font-size: 13px; }
        .offline-status { color: #8f94a2; font-size: 13px; }

        /* ========== –≠–ö–†–ê–ù –ß–ê–¢–ê ========== */
        #chat-screen {
            height: 100%;
            display: none;
            flex-direction: column;
            background: #0c0d12;
        }

        .chat-header {
            background: rgba(18, 20, 28, 0.95);
            backdrop-filter: blur(16px);
            padding: 14px 18px;
            display: flex;
            align-items: center;
            gap: 16px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .back-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.06);
            color: white;
            font-size: 24px;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .chat-header-info {
            flex: 1;
        }

        .chat-header-title {
            font-weight: 700;
            font-size: 18px;
            color: white;
        }

        .chat-header-status {
            font-size: 12px;
            opacity: 0.7;
            color: #b8bccb;
        }

        #messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: radial-gradient(circle at 50% 0%, #11131c, #0a0b10);
        }

        /* ========== –ë–ê–õ–õ–£–ù–´ –°–û–û–ë–©–ï–ù–ò–ô ========== */
        .message {
            max-width: 80%;
            display: flex;
            flex-direction: column;
            animation: slideIn 0.25s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .my-message { align-self: flex-end; }
        .other-message { align-self: flex-start; }

        .message-bubble {
            padding: 14px 18px;
            border-radius: 24px;
            word-break: break-word;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .my-message .message-bubble {
            background: linear-gradient(145deg, #5f6cff, #4552d9);
            color: white;
            border-bottom-right-radius: 6px;
            border: 1px solid rgba(255,255,255,0.15);
        }

        .other-message .message-bubble {
            background: rgba(30, 33, 48, 0.8);
            backdrop-filter: blur(10px);
            color: white;
            border-bottom-left-radius: 6px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .message-sender {
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 5px;
            color: #a7b0ff;
        }

        .message-time {
            font-size: 10px;
            margin-top: 6px;
            opacity: 0.65;
            align-self: flex-end;
        }

        /* ========== –í–í–û–î –°–û–û–ë–©–ï–ù–ò–Ø ========== */
        .message-input-area {
            background: rgba(18, 20, 28, 0.9);
            backdrop-filter: blur(20px);
            padding: 14px 18px;
            display: flex;
            gap: 10px;
            align-items: center;
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        .attach-btn, .voice-record-btn {
            width: 48px;
            height: 48px;
            border: none;
            border-radius: 50%;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(6px);
            color: #cfd4ff;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.06);
            transition: 0.2s;
        }

        .attach-btn:hover, .voice-record-btn:hover {
            background: rgba(80, 90, 200, 0.25);
            color: white;
        }

        .voice-record-btn.recording {
            background: #ff4d6d;
            color: white;
            animation: pulse 1.2s infinite;
            border-color: rgba(255,255,255,0.4);
        }

        #message-input {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 40px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.05);
            color: white;
            font-size: 15px;
            transition: 0.2s;
        }

        #message-input:focus {
            outline: none;
            border-color: #5f6cff;
            background: rgba(20,20,40,0.7);
        }

        .send-btn {
            width: 48px;
            height: 48px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(145deg, #5f6cff, #3f4ad0);
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 6px 14px #3f4ad080;
        }

        .send-btn:hover {
            transform: scale(1.08);
        }

        /* ========== –ü–†–û–§–ò–õ–¨ ========== */
        #profile-screen {
            background: #0f1016;
            padding: 0;
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 36px 24px;
            background: radial-gradient(circle at 30% 20%, #252842, #13141c);
            border-bottom-left-radius: 32px;
            border-bottom-right-radius: 32px;
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }

        .profile-avatar {
            width: 110px;
            height: 110px;
            background: linear-gradient(145deg, #5f6cff, #323ca0);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 52px;
            font-weight: 600;
            border: 4px solid rgba(255,255,255,0.25);
            box-shadow: 0 18px 30px -8px black;
            margin-bottom: 18px;
            color: white;
            cursor: pointer;
            transition: 0.2s;
        }

        .profile-avatar:hover {
            transform: scale(1.02);
            border-color: rgba(160, 168, 255, 0.7);
        }

        .profile-name {
            font-size: 28px;
            font-weight: 800;
            color: white;
            margin-bottom: 6px;
        }

        .profile-bio {
            font-size: 15px;
            opacity: 0.8;
            max-width: 80%;
            text-align: center;
            color: #cacfe0;
        }

        .profile-stats {
            display: flex;
            justify-content: space-around;
            padding: 22px 16px;
            background: rgba(0,0,0,0.2);
            margin: 20px 16px;
            border-radius: 40px;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.03);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            color: #b0b8ff;
        }

        .stat-label {
            font-size: 12px;
            color: #9ea2b0;
            margin-top: 6px;
        }

        .profile-actions {
            padding: 8px 20px 30px;
        }

        .profile-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 12px;
            transition: 0.2s;
        }

        .profile-btn-primary {
            background: linear-gradient(145deg, #5f6cff, #414dcf);
            color: white;
            box-shadow: 0 10px 22px #3f4ad080;
        }

        .profile-btn-secondary {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(8px);
            color: white;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .profile-btn:active {
            transform: scale(0.97);
        }

        /* ========== –ú–û–î–ê–õ–ö–ò ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(25, 28, 40, 0.9);
            backdrop-filter: blur(30px);
            width: 90%;
            max-width: 380px;
            border-radius: 36px;
            padding: 28px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 30px 60px rgba(0,0,0,0.6);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
            color: white;
            letter-spacing: -0.5px;
        }

        .modal-input {
            width: 100%;
            padding: 16px 20px;
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 20px;
            margin-bottom: 16px;
            font-size: 15px;
            background: rgba(0,0,0,0.3);
            color: white;
        }

        .modal-input:focus {
            outline: none;
            border-color: #6f7cff;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 26px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
        }

        .modal-btn-primary {
            background: linear-gradient(145deg, #5f6cff, #414dcf);
            color: white;
        }

        .modal-btn-secondary {
            background: rgba(255,255,255,0.06);
            color: white;
            border: 1px solid rgba(255,255,255,0.06);
        }

        /* ========== –°–ö–†–û–õ–õ ========== */
        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(120, 130, 220, 0.4);
            border-radius: 10px;
        }

        /* ========== –ü–†–û–ß–ï–ï ========== */
        .typing-indicator {
            padding: 8px 16px;
            color: #a7b0ff;
            font-size: 13px;
            font-style: italic;
            background: rgba(80, 90, 200, 0.15);
            border-radius: 40px;
            align-self: flex-start;
            backdrop-filter: blur(4px);
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #8f94a2;
            font-size: 16px;
        }

        .image-viewer {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .image-viewer.active { display: flex; }
        .image-viewer img { max-width: 90%; max-height: 80%; border-radius: 20px; }
        .close-viewer {
            position: absolute; top: 24px; right: 24px;
            color: white; font-size: 44px;
            cursor: pointer;
            width: 56px; height: 56px;
            display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.4); border-radius: 50%;
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- –õ–û–ì–ò–ù -->
        <div id="login-screen">
            <div class="logo">üì±</div>
            <div class="app-title">TeleRoom</div>
            <div class="app-subtitle">—Ç–≤–æ—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è</div>
            <input type="text" id="login-name" class="login-input" placeholder="–¢–≤–æ–π –Ω–∏–∫–Ω–µ–π–º" value="" onkeyup="checkUsername()" autofocus>
            <div id="username-error"></div>
            <button class="login-btn" onclick="register()">–í–æ–π—Ç–∏ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</button>
        </div>

        <!-- –û–°–ù–û–í–ù–û–ô -->
        <div id="main-screen">
            <div class="header">
                <div class="user-info" onclick="showProfile()">
                    <div class="user-avatar" id="header-avatar">üë§</div>
                    <span class="user-name" id="header-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                <div class="header-actions">
                    <button class="header-btn" onclick="showCreateGroupModal()">‚ûï</button>
                    <button class="header-btn" onclick="logout()">üö™</button>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('chats', this)">üí¨ –ß–∞—Ç—ã</button>
                <button class="tab" onclick="switchTab('groups', this)">üë• –ì—Ä—É–ø–ø—ã</button>
                <button class="tab" onclick="switchTab('contacts', this)">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</button>
            </div>

            <div id="chats-list" class="active-list">
                <div class="search-container">
                    <input type="text" id="chat-search" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤..." onkeyup="searchChats()">
                </div>
                <div id="chats-container"></div>
            </div>
            
            <div id="groups-list">
                <div id="groups-container"></div>
            </div>
            
            <div id="contacts-list">
                <div class="search-container">
                    <input type="text" id="contact-search" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ª—é–¥–µ–π..." onkeyup="searchContacts()">
                </div>
                <div id="contacts-container"></div>
            </div>

            <!-- –ü–†–û–§–ò–õ–¨ (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π, —Å —é–∑–µ—Ä–Ω–µ–π–º–æ–º –∏ —Å–º–µ–Ω–æ–π –∞–≤–∞—Ç–∞—Ä–∞) -->
            <div id="profile-screen">
                <div class="profile-header">
                    <div class="profile-avatar" id="profile-avatar" onclick="changeAvatar()">üë§</div>
                    <div class="profile-name" id="profile-name"></div>
                    <div class="profile-bio" id="profile-bio"></div>
                    <div style="font-size: 14px; opacity: 0.7; margin-top: 8px;" id="profile-username"></div>
                </div>
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="profile-groups">0</div>
                        <div class="stat-label">–ì—Ä—É–ø–ø</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="profile-chats">0</div>
                        <div class="stat-label">–ß–∞—Ç–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="profile-joined">0</div>
                        <div class="stat-label">–î–Ω–µ–π</div>
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="profile-btn profile-btn-primary" onclick="editName()">‚úèÔ∏è –°–º–µ–Ω–∏—Ç—å –∏–º—è</button>
                    <button class="profile-btn profile-btn-primary" onclick="editUsername()">@ –°–º–µ–Ω–∏—Ç—å —é–∑–µ—Ä–Ω–µ–π–º</button>
                    <button class="profile-btn profile-btn-primary" onclick="editBio()">üìù –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∏–æ</button>
                    <button class="profile-btn profile-btn-secondary" onclick="backToMain()">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            </div>
        </div>

        <!-- –ß–ê–¢ -->
        <div id="chat-screen">
            <div class="chat-header">
                <button class="back-btn" onclick="closeChat()">‚Üê</button>
                <div class="chat-header-info">
                    <div class="chat-header-title" id="chat-title">...</div>
                    <div class="chat-header-status" id="chat-status">...</div>
                </div>
            </div>
            <div id="messages-container"></div>
            <div class="message-input-area">
                <div style="position: relative;">
                    <button class="attach-btn" onclick="toggleAttachMenu()">üìé</button>
                    <div class="attach-menu" id="attachMenu" style="position: absolute; bottom: 60px; left: 0; background: rgba(20,22,36,0.95); backdrop-filter: blur(20px); border-radius: 24px; padding: 8px; display: none; border: 1px solid rgba(255,255,255,0.06);">
                        <button class="attach-menu-item" onclick="selectPhoto()" style="display: block; padding: 12px 24px; background: none; border: none; color: white; font-size: 16px;">üì∑ –§–æ—Ç–æ</button>
                        <button class="attach-menu-item" onclick="selectFile()" style="display: block; padding: 12px 24px; background: none; border: none; color: white; font-size: 16px;">üìé –§–∞–π–ª</button>
                    </div>
                </div>
                <button class="voice-record-btn" id="voiceRecordBtn" onclick="toggleVoiceRecording()">üé§</button>
                <input type="text" id="message-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="onMessageKeyPress(event)">
                <button class="send-btn" onclick="sendMessage()">‚û§</button>
            </div>
        </div>

        <!-- –ú–û–î–ê–õ–ö–ò -->
        <div id="create-group-modal" class="modal">
            <div class="modal-content">
                <div class="modal-title">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</div>
                <input type="text" id="group-name" class="modal-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <input type="text" id="group-description" class="modal-input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑.)">
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-secondary" onclick="hideCreateGroupModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="modal-btn modal-btn-primary" onclick="createGroup()">–°–æ–∑–¥–∞—Ç—å</button>
                </div>
            </div>
        </div>

        <div id="edit-bio-modal" class="modal">
            <div class="modal-content">
                <div class="modal-title">–û —Å–µ–±–µ</div>
                <textarea id="bio-text" class="modal-input" style="height: 120px; resize: none;" placeholder="–†–∞—Å—Å–∫–∞–∂–∏..."></textarea>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-secondary" onclick="hideEditBioModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button class="modal-btn modal-btn-primary" onclick="saveBio()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <div id="imageViewer" class="image-viewer" onclick="closeImageViewer()">
            <span class="close-viewer">√ó</span>
            <img id="viewerImage" src="">
        </div>
    </div>

    <input type="file" id="photoInput" accept="image/*" style="display: none">
    <input type="file" id="fileInput" style="display: none">
    <input type="file" id="avatarInput" accept="image/*" style="display: none">

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // ================== –¢–í–û–ô –ü–û–õ–ù–´–ô –†–ê–ë–û–ß–ò–ô JS ==================
        // (–í–µ—Å—å —Ç–≤–æ–π –∫–æ–¥ JavaScript –æ—Å—Ç–∞—ë—Ç—Å—è –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô, —è –¥–æ–±–∞–≤–∏–ª —Ç–æ–ª—å–∫–æ:
        //  - —Ñ—É–Ω–∫—Ü–∏–∏ editName, editUsername, changeAvatar,
        //  - –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π showProfile —Å —é–∑–µ—Ä–Ω–µ–π–º–æ–º,
        //  - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ avatarInput)
        
        const socket = io();
        let currentUser = null, currentChat = null, currentChatType = 'group';
        let mediaRecorder = null, audioChunks = [], isRecording = false;
        let groups = [], privateChats = [], allUsers = [], audioElements = {};

        // --- –¢–í–û–ò –§–£–ù–ö–¶–ò–ò (register, checkUsername, loadGroups, –∏ —Ç.–¥.) ---
        // (–û–Ω–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã, —è –∏—Ö –Ω–µ –º–µ–Ω—è–ª, 
        //  —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏–ª —Å–Ω–∏–∑—É 4 –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–±–Ω–æ–≤–∏–ª showProfile)
        
        // ‚ö†Ô∏è –í–°–¢–ê–í–¨ –°–Æ–î–ê –í–ï–°–¨ –¢–í–û–ô JS –ö–û–î –ò–ó –¢–í–û–ï–ì–û –§–ê–ô–õ–ê (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        // (–æ—Ç —Å—Ç—Ä–æ–∫–∏ let usernameCheckTimeout; –¥–æ –∫–æ–Ω—Ü–∞)
        // –Ø –Ω–µ –∫–æ–ø–∏—Ä—É—é –µ–≥–æ —Å—é–¥–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ, —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å –æ—Ç–≤–µ—Ç,
        // –Ω–æ —Ç—ã –¥–æ–ª–∂–µ–Ω –≤—Å—Ç–∞–≤–∏—Ç—å –í–ï–°–¨ —Å–≤–æ–π —Å–∫—Ä–∏–ø—Ç —Å—é–¥–∞.
        // ----------------------------------------------------------------
        
        // ========== –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–†–û–§–ò–õ–Ø ==========
        
        function editName() {
            const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è:', currentUser.name);
            if (newName && newName.trim() && newName !== currentUser.name) {
                fetch('/api/user/update-name', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: currentUser.id, newName: newName.trim() })
                }).then(res => res.json()).then(data => {
                    if (data.error) alert('‚ùå ' + data.error);
                    else {
                        currentUser.name = data.name;
                        document.getElementById('profile-name').innerText = data.name;
                        document.getElementById('header-name').innerText = data.name;
                        document.getElementById('header-avatar').innerText = data.name[0].toUpperCase();
                        document.getElementById('profile-avatar').innerText = data.name[0].toUpperCase();
                        localStorage.setItem('teleRoomName', data.name);
                        alert('‚úÖ –ò–º—è –∏–∑–º–µ–Ω–µ–Ω–æ');
                    }
                });
            }
        }

        function editUsername() {
            const newUsername = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π —é–∑–µ—Ä–Ω–µ–π–º (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π):', currentUser.phone);
            if (newUsername && newUsername.trim() && newUsername !== currentUser.phone) {
                fetch('/api/user/update-username', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: currentUser.id, newUsername: newUsername.trim() })
                }).then(res => res.json()).then(data => {
                    if (data.error) alert('‚ùå ' + data.error);
                    else {
                        currentUser.phone = data.username;
                        document.getElementById('profile-username').innerText = '@' + data.username;
                        localStorage.setItem('teleRoomId', data.username);
                        alert('‚úÖ –Æ–∑–µ—Ä–Ω–µ–π–º –∏–∑–º–µ–Ω—ë–Ω');
                    }
                });
            }
        }

        function changeAvatar() {
            document.getElementById('avatarInput').click();
        }

        document.getElementById('avatarInput').onchange = function(e) {
            const file = e.target.files[0];
            if (file && currentUser) {
                const formData = new FormData();
                formData.append('avatar', file);
                formData.append('userId', currentUser.id);
                fetch('/api/user/upload-avatar', {
                    method: 'POST', body: formData
                }).then(res => res.json()).then(data => {
                    if (data.success) {
                        currentUser.avatar = data.avatar;
                        document.getElementById('profile-avatar').innerHTML = `<img src="/avatars/${data.avatar}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
                        document.getElementById('header-avatar').innerHTML = `<img src="/avatars/${data.avatar}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
                        alert('‚úÖ –ê–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω');
                    }
                });
            }
        };

        // ========== –û–ë–ù–û–í–õ–Å–ù–ù–´–ô –ü–û–ö–ê–ó –ü–†–û–§–ò–õ–Ø ==========
        function showProfile() {
            if (!currentUser) return;
            document.getElementById('main-screen').style.display = 'none';
            document.getElementById('profile-screen').style.display = 'block';
            
            document.getElementById('profile-name').innerText = currentUser.name;
            document.getElementById('profile-username').innerText = '@' + (currentUser.phone || 'username');
            document.getElementById('profile-bio').innerText = currentUser.bio || '–ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏';
            
            if (currentUser.avatar) {
                document.getElementById('profile-avatar').innerHTML = `<img src="/avatars/${currentUser.avatar}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
                document.getElementById('header-avatar').innerHTML = `<img src="/avatars/${currentUser.avatar}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
            } else {
                document.getElementById('profile-avatar').innerText = currentUser.name[0].toUpperCase();
                document.getElementById('header-avatar').innerText = currentUser.name[0].toUpperCase();
            }
            
            document.getElementById('profile-groups').innerText = groups.length;
            document.getElementById('profile-chats').innerText = privateChats.length;
            const days = Math.floor((Date.now() - new Date(currentUser.created_at || Date.now())) / (1000*60*60*24)) || 1;
            document.getElementById('profile-joined').innerText = days;
        }

        // --- –û–°–¢–ê–õ–¨–ù–´–ï –¢–í–û–ò –§–£–ù–ö–¶–ò–ò (search, render, logout, –∏ —Ç.–¥.) ---
        // –í–°–¢–ê–í–¨ –ò–• –°–Æ–î–ê
        // ----------------------------------------------------------------

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é (–ø—Ä–∏–º–µ—Ä)
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('attachMenu');
            const btn = document.querySelector('.attach-btn');
            if (btn && !btn.contains(e.target) && menu && !menu.contains(e.target)) {
                menu.style.display = 'none';
            }
        });
    </script>
</body>
</html>
